<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SoftGrid Nav Pro</title>
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #1a1a1a; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        
        .nav-header {
            position: absolute; top: 0; width: 100%; background: rgba(0, 31, 63, 0.95);
            color: white; padding: 20px; z-index: 10; text-align: center;
            border-bottom: 3px solid #00d0ff; font-family: sans-serif;
        }

        .car-marker {
            width: 50px; height: 50px;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
        }

        /* Stil pentru pin-ul de sosire */
        .destination-pin {
            background-image: url('https://cdn-icons-png.flaticon.com/512/1483/1483336.png');
            background-size: cover; width: 40px; height: 40px;
        }
    </style>
</head>
<body>

<div class="nav-header">
    <div id="distance" style="font-size: 28px; font-weight: bold;">-- km</div>
    <div id="arrival" style="font-size: 14px; color: #00d0ff;">Calculare timp estimat...</div>
</div>

<div id="map"></div>

<script>
    const ghindaoani = [26.3311, 47.1064];
    
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
        center: [26.106, 44.432],
        zoom: 17,
        pitch: 65,
        bearing: 0
    });

    // RETUȘ 1: Adăugăm marcaj la destinație
    const destEl = document.createElement('div');
    destEl.className = 'destination-pin';
    new maplibregl.Marker({element: destEl}).setLngLat(ghindaoani).addTo(map);

    // Săgeata (Mașina)
    const carEl = document.createElement('div');
    carEl.innerHTML = `<svg class="car-marker" viewBox="0 0 100 100"><path d="M50 5 L95 95 L50 75 L5 95 Z" fill="#00d0ff" stroke="white" stroke-width="4"/></svg>`;
    const carMarker = new maplibregl.Marker({element: carEl, rotationAlignment: 'map'}).setLngLat([26.106, 44.432]).addTo(map);

    async function getRoute(currentPos) {
        const url = `https://router.project-osrm.org/route/v1/driving/${currentPos[0]},${currentPos[1]};${ghindaoani[0]},${ghindaoani[1]}?overview=full&geometries=geojson`;
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.routes && data.routes[0]) {
            const route = data.routes[0];
            document.getElementById('distance').innerText = (route.distance / 1000).toFixed(1) + " km";
            document.getElementById('arrival').innerText = "Sosire în aprox. " + Math.round(route.duration / 60) + " min";
            
            if (map.getSource('route')) {
                map.getSource('route').setData(route.geometry);
            } else {
                map.addSource('route', { type: 'geojson', data: route.geometry });
                map.addLayer({
                    id: 'route', type: 'line', source: 'route',
                    paint: { 'line-color': '#00d0ff', 'line-width': 10, 'line-opacity': 0.8 }
                });
            }
        }
    }

    navigator.geolocation.watchPosition(pos => {
        const userPos = [pos.coords.longitude, pos.coords.latitude];
        const heading = pos.coords.heading || 0;

        carMarker.setLngLat(userPos);

        // RETUȘ 2: Camera Offset & Smooth Movement
        // Folosim 'padding' pentru a ține mașina mai jos de centru
        map.easeTo({
            center: userPos,
            bearing: heading,
            padding: { top: 300 }, // Împinge mașina în jos ca să vezi drumul în față
            duration: 1500,        // Tranziție lină de 1.5 secunde
            essential: true
        });

        getRoute(userPos);
    }, null, { enableHighAccuracy: true });
</script>
</body>
</html>