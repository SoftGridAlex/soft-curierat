<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Navigație Ghindăoani</title>
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .nav-info {
            position: absolute; top: 10px; left: 10px; right: 10px;
            background: #00d0ff; color: white; padding: 15px;
            border-radius: 10px; text-align: center; font-family: sans-serif;
            font-weight: bold; z-index: 10;
        }
    </style>
</head>
<body>

<div class="nav-info" id="status">Căutare rută spre Ghindăoani...</div>
<div id="map"></div>

<script>
    // Coordonate Ghindăoani (aproximativ)
    const destInatie = [26.3311, 47.1064]; 

    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
        center: [26.106, 44.432], // Start București (se va schimba la GPS-ul tău)
        zoom: 13,
        pitch: 60
    });

    // Săgeata
    const el = document.createElement('div');
    el.innerHTML = `<svg width="40" height="40" viewBox="0 0 100 100"><path d="M50 5 L90 95 L50 75 L10 95 Z" fill="#0047ff" stroke="white" stroke-width="5"/></svg>`;
    const marker = new maplibregl.Marker({element: el}).setLngLat([26.106, 44.432]).addTo(map);

    // FUNCȚIE: Cere drumul de la motorul de hărți (GRATIS)
    async function iaTraseu(start) {
        const url = `https://router.project-osrm.org/route/v1/driving/${start[0]},${start[1]};${destInatie[0]},${destInatie[1]}?overview=full&geometries=geojson`;
        
        const response = await fetch(url);
        const data = await response.json();
        const route = data.routes[0].geometry;

        // Punem linia albastră pe hartă
        if (map.getSource('route')) {
            map.getSource('route').setData(route);
        } else {
            map.addLayer({
                'id': 'route',
                'type': 'line',
                'source': { 'type': 'geojson', 'data': route },
                'layout': { 'line-join': 'round', 'line-cap': 'round' },
                'paint': { 'line-color': '#0047ff', 'line-width': 8, 'line-opacity': 0.8 }
            });
        }
        document.getElementById('status').innerText = "Destinație: Ghindăoani";
    }

    navigator.geolocation.watchPosition(pos => {
        const userLoc = [pos.coords.longitude, pos.coords.latitude];
        marker.setLngLat(userLoc);
        map.easeTo({ center: userLoc, bearing: pos.coords.heading || 0 });
        iaTraseu(userLoc); // Actualizează linia în timp ce mergi
    }, err => console.error(err), { enableHighAccuracy: true });

</script>
</body>
</html>
