<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Curier Pro - NavigaÈ›ie 3D</title>
    
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />

    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #1a1a1a; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }

        /* UI de NavigaÈ›ie (Sus) */
        .waze-ui-top {
            position: absolute; top: 0; width: 100%; height: 70px;
            background: #00d0ff; color: white; z-index: 10;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* SÄƒgeata de NavigaÈ›ie */
        .navigation-arrow {
            width: 60px; height: 60px;
            filter: drop-shadow(0px 6px 4px rgba(0,0,0,0.5));
        }

        /* Buton Activare GPS */
        .gps-btn {
            position: absolute; bottom: 30px; right: 20px;
            width: 65px; height: 65px; background: white;
            border-radius: 50%; border: none; z-index: 10;
            font-size: 28px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>

<div class="waze-ui-top" id="info">ApasÄƒ pe ðŸŽ¯ pentru Start</div>
<button class="gps-btn" onclick="pornesteGPS()">ðŸŽ¯</button>
<div id="map"></div>

<script>
    // 1. Configurarea hÄƒrÈ›ii cu stil Dark gratuit (CartoDB)
    const map = new maplibregl.Map({
        container: 'map',
        style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
        center: [26.106, 44.432], // BucureÈ™ti
        zoom: 17,
        pitch: 65,     // ÃŽnclinarea 3D
        bearing: 0,    // RotaÈ›ia
        antialias: true
    });

    // 2. Crearea SÄƒgeÈ›ii (SVG)
    const arrowDiv = document.createElement('div');
    arrowDiv.innerHTML = `
        <svg class="navigation-arrow" viewBox="0 0 100 100">
            <path d="M50 5 L90 95 L50 75 L10 95 Z" fill="#0047ff" stroke="white" stroke-width="6"/>
        </svg>`;

    const marker = new maplibregl.Marker({ element: arrowDiv })
        .setLngLat([26.106, 44.432])
        .addTo(map);

    // 3. FuncÈ›ia principalÄƒ de GPS
    function pornesteGPS() {
        if (!navigator.geolocation) {
            alert("Browserul tÄƒu nu suportÄƒ GPS.");
            return;
        }

        // Cerem locaÈ›ia oficial
        navigator.geolocation.watchPosition((pos) => {
            const { latitude, longitude, heading } = pos.coords;
            const myLocation = [longitude, latitude];

            // MutÄƒm sÄƒgeata È™i centrÄƒm harta
            marker.setLngLat(myLocation);
            map.flyTo({ center: myLocation, duration: 1000, essential: true });

            // DacÄƒ te miÈ™ti (ai direcÈ›ie), rotim harta dupÄƒ tine
            if (heading !== null) {
                map.setBearing(heading);
                arrowDiv.style.transform = `rotate(${heading}deg)`;
            }

            document.getElementById('info').innerText = "NavigaÈ›ie ActivÄƒ";
        }, 
        (err) => alert("Eroare GPS: AsigurÄƒ-te cÄƒ eÈ™ti pe HTTPS È™i ai dat 'Allow'"), 
        { enableHighAccuracy: true });
    }

    // 4. AdÄƒugare clÄƒdiri 3D cÃ¢nd harta este gata
    map.on('load', () => {
        map.addLayer({
            'id': '3d-buildings',
            'source': 'openmaptiles',
            'source-layer': 'building',
            'type': 'fill-extrusion',
            'minzoom': 15,
            'paint': {
                'fill-extrusion-color': '#333',
                'fill-extrusion-height': ['get', 'render_height'],
                'fill-extrusion-opacity': 0.8
            }
        });
    });
</script>

</body>
</html>